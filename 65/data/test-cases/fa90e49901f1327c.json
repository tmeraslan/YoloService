{"uid":"fa90e49901f1327c","name":"test_predict_runs_yolo_and_saves_image","fullName":"tests.test_predict.TestPredictEndpoint#test_predict_runs_yolo_and_saves_image","historyId":"ce88b167149fb36223aba5866fd64bc3","time":{"start":1757418115325,"stop":1757418115336,"duration":11},"status":"failed","statusMessage":"AssertionError: 's3' not found in {'prediction_uid': '505cb6a3-4281-41a1-b5f4-4221570b267a', 'detection_count': 0, 'labels': [], 'time_took': 0.001, 'user_id': 'testuser', 'predicted_s3_key': 'testuser/predicted/505cb6a3-4281-41a1-b5f4-4221570b267a.jpg'}","statusTrace":"self = <tests.test_predict.TestPredictEndpoint testMethod=test_predict_runs_yolo_and_saves_image>\nmock_save_img = <MagicMock name='save' id='140161907926624'>\nmock_open_func = <MagicMock name='open' id='140161907932432'>\nmock_copyfileobj = <MagicMock name='copyfileobj' id='140161907995040'>\nmock_model = <MagicMock name='model' id='140161908267760'>\nmock_save_session = <MagicMock name='query_save_prediction_session' id='140161908271456'>\n\n    @patch(\"queries.query_save_prediction_session\")\n    @patch(\"controllers.model\")\n    @patch(\"shutil.copyfileobj\")\n    @patch(\"builtins.open\", new_callable=mock_open)\n    @patch(\"PIL.Image.Image.save\")\n    def test_predict_runs_yolo_and_saves_image(\n        self,\n        mock_save_img,\n        mock_open_func,\n        mock_copyfileobj,\n        mock_model,\n        mock_save_session,\n    ):\n        mock_result = MagicMock()\n        mock_result.boxes = []\n        img = Image.new(\"RGB\", (20, 20), color=(0, 255, 0))\n        mock_result.plot.return_value = np.array(img)\n        mock_model.return_value = [mock_result]\n    \n        img_bytes = create_image_bytes()\n        files = {\"file\": (\"cover.jpg\", img_bytes, \"image/jpeg\")}\n        resp = client.post(\"/predict\", files=files, headers=get_auth_headers())\n    \n        self.assertEqual(resp.status_code, 200)\n        data = resp.json()\n        self.assertIn(\"prediction_uid\", data)\n        # ודא שהשירות ניסה לשמור את התמונה\n        self.assertTrue(mock_save_img.called)\n    \n        # בדיקת בלוק ה-S3\n>       self.assertIn(\"s3\", data)\nE       AssertionError: 's3' not found in {'prediction_uid': '505cb6a3-4281-41a1-b5f4-4221570b267a', 'detection_count': 0, 'labels': [], 'time_took': 0.001, 'user_id': 'testuser', 'predicted_s3_key': 'testuser/predicted/505cb6a3-4281-41a1-b5f4-4221570b267a.jpg'}\n\ntests/test_predict.py:126: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"fake_ultralytics_module","time":{"start":1757418114984,"stop":1757418114984,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_unittest_setUpClass_fixture_TestPredictEndpoint","time":{"start":1757418115273,"stop":1757418115273,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"mock_verify_user","time":{"start":1757418115325,"stop":1757418115325,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch","time":{"start":1757418115325,"stop":1757418115325,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"stub_queries_writes","time":{"start":1757418115325,"stop":1757418115325,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"monkeypatch::0","time":{"start":1757418115344,"stop":1757418115344,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_unittest_setUpClass_fixture_TestPredictEndpoint::0","time":{"start":1757418115383,"stop":1757418115383,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"fake_ultralytics_module::0","time":{"start":1757418115421,"stop":1757418115421,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_predict"},{"name":"subSuite","value":"TestPredictEndpoint"},{"name":"host","value":"pkrvm7jw40e0xgp"},{"name":"thread","value":"2346-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_predict"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"fa90e49901f1327c.json","parameterValues":[]}