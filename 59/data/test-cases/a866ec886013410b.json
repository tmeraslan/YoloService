{"uid":"a866ec886013410b","name":"test_predict_endpoint_basic","fullName":"tests.test_predict.TestPredictEndpoint#test_predict_endpoint_basic","historyId":"ed8fa186a1bf42188ca8f96c5f680ca1","time":{"start":1757237335600,"stop":1757237335613,"duration":13},"status":"failed","statusMessage":"AssertionError: 's3' not found in {'prediction_uid': '3d70a71f-b6ca-461f-b59a-2ee7f41318fd', 'detection_count': 0, 'labels': [], 'time_took': 0.001, 'user_id': 'testuser', 'predicted_s3_key': 'testuser/predicted/3d70a71f-b6ca-461f-b59a-2ee7f41318fd.jpg'}","statusTrace":"self = <tests.test_predict.TestPredictEndpoint testMethod=test_predict_endpoint_basic>\nmock_save_img = <MagicMock name='save' id='139751537230240'>\nmock_open_func = <MagicMock name='open' id='139751537234512'>\nmock_copyfileobj = <MagicMock name='copyfileobj' id='139751537235616'>\nmock_model = <MagicMock name='model' id='139751537806656'>\nmock_save_session = <MagicMock name='query_save_prediction_session' id='139751561505792'>\n\n    @patch(\"queries.query_save_prediction_session\")\n    @patch(\"controllers.model\")\n    @patch(\"shutil.copyfileobj\")\n    @patch(\"builtins.open\", new_callable=mock_open)\n    @patch(\"PIL.Image.Image.save\")\n    def test_predict_endpoint_basic(\n        self,\n        mock_save_img,\n        mock_open_func,\n        mock_copyfileobj,\n        mock_model,\n        mock_save_session,\n    ):\n        # תוצאת YOLO מדומה ללא תיבות\n        mock_result = MagicMock()\n        mock_result.boxes = []\n        img = Image.new(\"RGB\", (20, 20), color=(0, 255, 0))\n        mock_result.plot.return_value = np.array(img)\n        mock_model.return_value = [mock_result]\n    \n        img_bytes = create_image_bytes()\n        files = {\"file\": (\"dummy.jpg\", img_bytes, \"image/jpeg\")}\n        resp = client.post(\"/predict\", files=files, headers=get_auth_headers())\n    \n        self.assertEqual(resp.status_code, 200)\n        data = resp.json()\n        self.assertIn(\"prediction_uid\", data)\n        self.assertEqual(data[\"detection_count\"], 0)\n        self.assertEqual(data[\"labels\"], [])\n    \n        # בדיקת בלוק ה-S3\n>       self.assertIn(\"s3\", data)\nE       AssertionError: 's3' not found in {'prediction_uid': '3d70a71f-b6ca-461f-b59a-2ee7f41318fd', 'detection_count': 0, 'labels': [], 'time_took': 0.001, 'user_id': 'testuser', 'predicted_s3_key': 'testuser/predicted/3d70a71f-b6ca-461f-b59a-2ee7f41318fd.jpg'}\n\ntests/test_predict.py:86: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"fake_ultralytics_module","time":{"start":1757237335308,"stop":1757237335308,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"mock_verify_user","time":{"start":1757237335599,"stop":1757237335599,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_unittest_setUpClass_fixture_TestPredictEndpoint","time":{"start":1757237335599,"stop":1757237335599,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch","time":{"start":1757237335599,"stop":1757237335599,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"stub_queries_writes","time":{"start":1757237335600,"stop":1757237335600,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"monkeypatch::0","time":{"start":1757237335651,"stop":1757237335651,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_unittest_setUpClass_fixture_TestPredictEndpoint::0","time":{"start":1757237335712,"stop":1757237335712,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"fake_ultralytics_module::0","time":{"start":1757237335750,"stop":1757237335750,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_predict"},{"name":"subSuite","value":"TestPredictEndpoint"},{"name":"host","value":"pkrvm7jw40e0xgp"},{"name":"thread","value":"2207-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_predict"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"a866ec886013410b.json","parameterValues":[]}